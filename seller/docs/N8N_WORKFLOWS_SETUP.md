# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ n8n Workflows –¥–ª—è Seller Dashboard

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤—Å–µ—Ö n8n workflows –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ —Å–µ–ª–ª–µ—Ä–∞.

---

## 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ n8n

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```bash
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: n8n Cloud
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://n8n.io/cloud
2. –°–æ–∑–¥–∞—Ç—å workspace
3. –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Node.js 18+
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å n8n: `npm install n8n -g`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å: `n8n start`

### 1.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ n8n

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö n8n (Settings ‚Üí Environment Variables) –¥–æ–±–∞–≤–∏—Ç—å:

```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
PYTHON_SERVICES_URL=https://your-python-services.com
TELEGRAM_BOT_TOKEN=7976655354:AAEYrKQ6WI0asMaaHLEFZQHI3YfWPXRYo90
NEXTJS_API_URL=https://seller.vibelook.com/api
```

### 1.3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase

1. –í n8n –ø–µ—Ä–µ–π—Ç–∏ –≤ Credentials
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π credential —Ç–∏–ø–∞ "HTTP Header Auth" –∏–ª–∏ "Supabase"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
   - URL: `{{$env.SUPABASE_URL}}`
   - API Key: `{{$env.SUPABASE_SERVICE_ROLE_KEY}}`

### 1.4. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Python —Å–µ—Ä–≤–∏—Å–∞–º

1. –í n8n –ø–µ—Ä–µ–π—Ç–∏ –≤ Credentials
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π credential —Ç–∏–ø–∞ "HTTP Header Auth"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
   - URL: `{{$env.PYTHON_SERVICES_URL}}`
   - API Key: (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

## 2. Workflow 1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (sync-products.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ WB/Ozon —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ–ª–ª–µ—Ä–æ–≤ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Schedule Trigger
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 (–∏–ª–∏ –¥—Ä—É–≥–æ–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è)

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ–ª–ª–µ—Ä–æ–≤
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/rpc/get_sellers_with_api_keys`
- **Headers**:
  - `apikey`: `{{$env.SUPABASE_SERVICE_ROLE_KEY}}`
  - `Authorization`: `Bearer {{$env.SUPABASE_SERVICE_ROLE_KEY}}`
  - `Content-Type`: `application/json`
- **Body**: `{}`

#### –®–∞–≥ 2: Loop —á–µ—Ä–µ–∑ —Å–µ–ª–ª–µ—Ä–æ–≤
- **–ù–æ–¥–∞**: Split In Batches
- **Batch Size**: 1

#### –®–∞–≥ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è WB —Ç–æ–≤–∞—Ä–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á–∏)
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.wb_api_keys}}` –Ω–µ –ø—É—Å—Ç–æ–π
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**:
    - **–ú–µ—Ç–æ–¥**: POST
    - **URL**: `{{$env.PYTHON_SERVICES_URL}}/wb-service/sync-products`
    - **Body**:
      ```json
      {
        "seller_id": "{{$json.id}}",
        "api_keys": {{$json.wb_api_keys}}
      }
      ```

#### –®–∞–≥ 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Ozon —Ç–æ–≤–∞—Ä–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á–∏)
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.ozon_api_keys}}` –Ω–µ –ø—É—Å—Ç–æ–π
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**:
    - **–ú–µ—Ç–æ–¥**: POST
    - **URL**: `{{$env.PYTHON_SERVICES_URL}}/ozon-service/sync-products`
    - **Body**:
      ```json
      {
        "seller_id": "{{$json.id}}",
        "api_keys": {{$json.ozon_api_keys}}
      }
      ```

#### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PATCH
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/sellers?id=eq.{{$json.id}}`
- **Headers**: (—Ç–µ –∂–µ —á—Ç–æ –≤ —à–∞–≥–µ 1)
- **Body**:
  ```json
  {
    "last_sync_at": "{{$now}}",
    "sync_status": "completed"
  }
  ```

#### –®–∞–≥ 6: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ù–æ–¥–∞**: IF Error
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- **HTTP Request**:
  - **–ú–µ—Ç–æ–¥**: POST
  - **URL**: `https://api.telegram.org/bot{{$env.TELEGRAM_BOT_TOKEN}}/sendMessage`
  - **Body**:
    ```json
    {
      "chat_id": "{{$json.tg_user_id}}",
      "text": "–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {{$error.message}}"
    }
    ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Schedule Trigger (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–æ—á—å—é)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Retry 3 —Ä–∞–∑–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 5 –º–∏–Ω—É—Ç
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤

---

## 3. Workflow 2: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π (classify-products.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ AI —Å–µ—Ä–≤–∏—Å.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **Path**: `/classify-product`

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/products?id=eq.{{$json.product_id}}&select=*`
- **Headers**: (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Supabase headers)

#### –®–∞–≥ 2: –í—ã–∑–≤–∞—Ç—å AI —Å–µ—Ä–≤–∏—Å –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.PYTHON_SERVICES_URL}}/ai-service/classify-style`
- **Body**:
  ```json
  {
    "product_id": "{{$json.product_id}}",
    "image_urls": {{$json.image_urls}},
    "title": "{{$json.title}}",
    "description": "{{$json.description}}"
  }
  ```

#### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å style_tags –≤ Supabase
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PATCH
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/products?id=eq.{{$json.product_id}}`
- **Body**:
  ```json
  {
    "style_tags": {{$json.style_tags}}
  }
  ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Retry 2 —Ä–∞–∑–∞
- **–¢–∞–π–º–∞—É—Ç**: 30 —Å–µ–∫—É–Ω–¥

---

## 4. Workflow 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ª—É–∫–æ–≤ (generate-look-images.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –ª—É–∫–æ–≤ —á–µ—Ä–µ–∑ AI —Å–µ—Ä–≤–∏—Å.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **Path**: `/generate-look-images`

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ù–æ–¥–∞**: Set (–¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ**: `look_id`, `product_ids`, `style_tags`

#### –®–∞–≥ 2: –í—ã–∑–≤–∞—Ç—å Python AI —Å–µ—Ä–≤–∏—Å
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.PYTHON_SERVICES_URL}}/ai-service/generate-look`
- **Body**:
  ```json
  {
    "look_id": "{{$json.look_id}}",
    "product_ids": {{$json.product_ids}},
    "style_tags": {{$json.style_tags}},
    "usage_contexts": {{$json.usage_contexts}}
  }
  ```

#### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Supabase Storage
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.SUPABASE_URL}}/storage/v1/object/look-images/{{$json.look_id}}.jpg`
- **Headers**:
  - `Authorization`: `Bearer {{$env.SUPABASE_SERVICE_ROLE_KEY}}`
  - `Content-Type`: `image/jpeg`
- **Body**: Binary data –∏–∑ –æ—Ç–≤–µ—Ç–∞ AI —Å–µ—Ä–≤–∏—Å–∞

#### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –ª—É–∫–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PATCH
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/looks?id=eq.{{$json.look_id}}`
- **Body**:
  ```json
  {
    "main_image_url": "{{$env.SUPABASE_URL}}/storage/v1/object/public/look-images/{{$json.look_id}}.jpg",
    "status": "generated"
  }
  ```

#### –®–∞–≥ 5: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `https://api.telegram.org/bot{{$env.TELEGRAM_BOT_TOKEN}}/sendMessage`
- **Body**:
  ```json
  {
    "chat_id": "{{$json.tg_user_id}}",
    "text": "‚úÖ –õ—É–∫ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ."
  }
  ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–¢–∞–π–º–∞—É—Ç**: 120 —Å–µ–∫—É–Ω–¥ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Retry 1 —Ä–∞–∑, –∑–∞—Ç–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

---

## 5. Workflow 4: –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–∞–π–¥-–≤–∏–¥–µ–æ (create-look-video.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–∞–π–¥-–≤–∏–¥–µ–æ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ª—É–∫–∞.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **Path**: `/create-look-video`

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª—É–∫–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/looks?id=eq.{{$json.look_id}}&select=main_image_url,product_ids`

#### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- **–ù–æ–¥–∞**: HTTP Request (Loop)
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/products?id=in.({{$json.product_ids}})&select=image_urls`

#### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å —Å–ª–∞–π–¥-–≤–∏–¥–µ–æ
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.PYTHON_SERVICES_URL}}/ai-service/create-video`
- **Body**:
  ```json
  {
    "look_id": "{{$json.look_id}}",
    "images": [–º–∞—Å—Å–∏–≤ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π]
  }
  ```

#### –®–∞–≥ 4: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ –≤ Supabase Storage
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.SUPABASE_URL}}/storage/v1/object/look-videos/{{$json.look_id}}.mp4`
- **Body**: Binary data –≤–∏–¥–µ–æ

#### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å video_url –≤ —Ç–∞–±–ª–∏—Ü–µ looks
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PATCH
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/looks?id=eq.{{$json.look_id}}`
- **Body**:
  ```json
  {
    "video_url": "{{$env.SUPABASE_URL}}/storage/v1/object/public/look-videos/{{$json.look_id}}.mp4"
  }
  ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–µ–æ**: 1080x1080, 30fps, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 10-15 —Å–µ–∫—É–Ω–¥
- **–¢–∞–π–º–∞—É—Ç**: 180 —Å–µ–∫—É–Ω–¥

---

## 6. Workflow 5: –ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –≤ —Å–æ—Ü—Å–µ—Ç–∏ (post-to-socials.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–æ–≤ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **Path**: `/post-to-socials`

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞
- **–ù–æ–¥–∞**: Set
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: `post_id`, `look_id`, `platforms`, `post_text`

#### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ª—É–∫–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/looks?id=eq.{{$json.look_id}}&select=*`

#### –®–∞–≥ 3: Loop —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- **–ù–æ–¥–∞**: Split In Batches
- **Batch Size**: 1

#### –®–∞–≥ 4: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Instagram
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `instagram`
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**:
    - **–ú–µ—Ç–æ–¥**: POST
    - **URL**: `{{$env.PYTHON_SERVICES_URL}}/ads-service/post-instagram`
    - **Body**: –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞

#### –®–∞–≥ 5: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Facebook
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `facebook`
- **–í–Ω—É—Ç—Ä–∏ IF**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Instagram

#### –®–∞–≥ 6: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ VK
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `vk`
- **–í–Ω—É—Ç—Ä–∏ IF**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

#### –®–∞–≥ 7: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Telegram
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `telegram`
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**:
    - **–ú–µ—Ç–æ–¥**: POST
    - **URL**: `https://api.telegram.org/bot{{$env.TELEGRAM_BOT_TOKEN}}/sendPhoto`
    - **Body**: —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç

#### –®–∞–≥ 8: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Pinterest
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `pinterest`
- **–í–Ω—É—Ç—Ä–∏ IF**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

#### –®–∞–≥ 9: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `yandex_dzen`
- **–í–Ω—É—Ç—Ä–∏ IF**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

#### –®–∞–≥ 10: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ TikTok
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.platforms}}` —Å–æ–¥–µ—Ä–∂–∏—Ç `tiktok`
- **–í–Ω—É—Ç—Ä–∏ IF**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

#### –®–∞–≥ 11: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ—Å—Ç–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PATCH
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/posts?id=eq.{{$json.post_id}}`
- **Body**:
  ```json
  {
    "status": "posted",
    "posted_at": "{{$now}}",
    "external_post_ids": {{—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–π}}
  }
  ```

#### –®–∞–≥ 12: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- **–ù–æ–¥–∞**: HTTP Request (Telegram)
- **–¢–µ–∫—Å—Ç**: "–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ {{–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã}}"

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –î–ª—è –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –æ—Ç–¥–µ–ª—å–Ω–æ
- **Retry**: 2 —Ä–∞–∑–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

---

## 7. Workflow 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–∞–º–ø–∞–Ω–∏–π (update-campaign-metrics.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Schedule Trigger
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –ö–∞–∂–¥—ã–π —á–∞—Å

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/campaigns?status=eq.running&select=*`

#### –®–∞–≥ 2: Loop —á–µ—Ä–µ–∑ –∫–∞–º–ø–∞–Ω–∏–∏
- **–ù–æ–¥–∞**: Split In Batches
- **Batch Size**: 1

#### –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ Python —Å–µ—Ä–≤–∏—Å–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.PYTHON_SERVICES_URL}}/ads-service/campaign-metrics?campaign_id={{$json.id}}`

#### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Supabase
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/metrics_aggregate`
- **Body**:
  ```json
  {
    "seller_id": "{{$json.seller_id}}",
    "campaign_id": "{{$json.id}}",
    "date": "{{$today}}",
    "impressions": {{$json.impressions}},
    "clicks": {{$json.clicks}},
    "ctr": {{$json.ctr}},
    "spent_rub": {{$json.spent_rub}},
    "transitions_to_mp": {{$json.transitions_to_mp}},
    "cpa_to_mp": {{$json.cpa_to_mp}}
  }
  ```

#### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–∞–º–ø–∞–Ω–∏–∏ (–µ—Å–ª–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å)
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.ended_at}}` <= `{{$now}}`
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**: PATCH —Å—Ç–∞—Ç—É—Å –Ω–∞ `finished`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ß–∞—Å—Ç–æ—Ç–∞**: –ö–∞–∂–¥—ã–π —á–∞—Å (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –∫–∞–º–ø–∞–Ω–∏–µ–π

---

## 8. Workflow 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç–∏ (update-brand-awareness.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç–∏ –±—Ä–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ WB –∏ –Ø–Ω–¥–µ–∫—Å Wordstat.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Schedule Trigger
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –†–∞–∑ –≤ 3 –¥–Ω—è (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ–ª–ª–µ—Ä–æ–≤ —Å brand_name
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/sellers?brand_name=not.is.null&select=id,brand_name`

#### –®–∞–≥ 2: Loop —á–µ—Ä–µ–∑ —Å–µ–ª–ª–µ—Ä–æ–≤
- **–ù–æ–¥–∞**: Split In Batches
- **Batch Size**: 1

#### –®–∞–≥ 3: –í—ã–∑–≤–∞—Ç—å Python —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.PYTHON_SERVICES_URL}}/brand-awareness/update`
- **Body**:
  ```json
  {
    "seller_id": "{{$json.id}}",
    "brand_name": "{{$json.brand_name}}"
  }
  ```

#### –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Supabase
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/brand_awareness_index`
- **Body**:
  ```json
  {
    "seller_id": "{{$json.id}}",
    "date": "{{$today}}",
    "wb_search_volume": {{$json.wb_volume}},
    "yandex_wordstat_volume": {{$json.wordstat_volume}},
    "recommendation_text": "{{$json.recommendation}}"
  }
  ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ß–∞—Å—Ç–æ—Ç–∞**: –†–∞–∑ –≤ 3 –¥–Ω—è (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Schedule)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Retry 1 —Ä–∞–∑

---

## 9. Workflow 8: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram (send-telegram-notifications.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π workflow –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Webhook
- **–ú–µ—Ç–æ–¥**: POST
- **Path**: `/send-telegram-notification`

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å tg_user_id —Å–µ–ª–ª–µ—Ä–∞
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/sellers?id=eq.{{$json.seller_id}}&select=tg_user_id`

#### –®–∞–≥ 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–ù–æ–¥–∞**: Function
- **–ö–æ–¥**:
```javascript
const messageType = $input.item.json.type;
const data = $input.item.json.data;

let text = '';

switch(messageType) {
  case 'import_completed':
    text = `‚úÖ –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–≤–µ—Ä—à—ë–Ω!\n–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${data.count} —Ç–æ–≤–∞—Ä–æ–≤`;
    break;
  case 'look_generated':
    text = `‚ú® –õ—É–∫ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ.`;
    break;
  case 'free_attempts_ended':
    text = `‚ö†Ô∏è –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.\n–ö—É–ø–∏—Ç–µ –ø–∞–∫–µ—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–ë–∏–ª–ª–∏–Ω–≥".`;
    break;
  case 'campaign_started':
    text = `üöÄ –ö–∞–º–ø–∞–Ω–∏—è "${data.name}" –∑–∞–ø—É—â–µ–Ω–∞!`;
    break;
  case 'campaign_finished':
    text = `üèÅ –ö–∞–º–ø–∞–Ω–∏—è "${data.name}" –∑–∞–≤–µ—Ä—à–µ–Ω–∞.`;
    break;
  case 'campaign_error':
    text = `‚ùå –û—à–∏–±–∫–∞ –≤ –∫–∞–º–ø–∞–Ω–∏–∏ "${data.name}": ${data.error}`;
    break;
  case 'low_balance':
    text = `üí∞ –ù–∏–∑–∫–∏–π –±–∞–ª–∞–Ω—Å: ${data.balance} ‚ÇΩ\n–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–æ—à–µ–ª—ë–∫".`;
    break;
  case 'trial_ending_soon':
    text = `‚è∞ –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ${data.days} –¥–Ω–µ–π.\n–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –≤ —Ä–∞–∑–¥–µ–ª–µ "–ë–∏–ª–ª–∏–Ω–≥".`;
    break;
  case 'trial_ended':
    text = `üîí –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è.\n–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.`;
    break;
  default:
    text = data.message || '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç Vibelook Seller';
}

return { text };
```

#### –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `https://api.telegram.org/bot{{$env.TELEGRAM_BOT_TOKEN}}/sendMessage`
- **Body**:
  ```json
  {
    "chat_id": "{{$json.tg_user_id}}",
    "text": "{{$json.text}}",
    "parse_mode": "HTML"
  }
  ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Retry 2 —Ä–∞–∑–∞
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML —Ä–∞–∑–º–µ—Ç–∫–∏

---

## 10. Workflow 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è trial (check-trial-expiration.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ trial –ø–µ—Ä–∏–æ–¥–∞.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Schedule Trigger
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Å–µ–ª–ª–µ—Ä–æ–≤ —Å –∞–∫—Ç–∏–≤–Ω—ã–º trial
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/sellers?tariff_plan=eq.trial&trial_ends_at=not.is.null&select=*`

#### –®–∞–≥ 2: Loop —á–µ—Ä–µ–∑ —Å–µ–ª–ª–µ—Ä–æ–≤
- **–ù–æ–¥–∞**: Split In Batches
- **Batch Size**: 1

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è
- **–ù–æ–¥–∞**: Function
- **–ö–æ–¥**:
```javascript
const trialEndsAt = new Date($input.item.json.trial_ends_at);
const now = new Date();
const daysLeft = Math.ceil((trialEndsAt - now) / (1000 * 60 * 60 * 24));

return {
  seller_id: $input.item.json.id,
  tg_user_id: $input.item.json.tg_user_id,
  days_left: daysLeft,
  is_ended: daysLeft <= 0
};
```

#### –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å 2 –¥–Ω—è –∏–ª–∏ –º–µ–Ω—å—à–µ)
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.days_left}}` <= 2 –∏ `{{$json.days_left}}` > 0
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**: –í—ã–∑–≤–∞—Ç—å workflow "send-telegram-notifications" —Å —Ç–∏–ø–æ–º `trial_ending_soon`

#### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–µ—Å–ª–∏ trial –∑–∞–∫–æ–Ω—á–∏–ª—Å—è)
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.is_ended}}` = true
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**: PATCH —Å—Ç–∞—Ç—É—Å –Ω–∞ `trial_ended` –∏ `is_blocked` = true
  - **HTTP Request**: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ `trial_ended`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏**: 09:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ

---

## 11. Workflow 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∑–∫–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (check-low-balance.json)

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ –¥–ª—è Pro/Enterprise —Ç–∞—Ä–∏—Ñ–æ–≤.

### –¢—Ä–∏–≥–≥–µ—Ä
- **–¢–∏–ø**: Schedule Trigger
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00

### –®–∞–≥–∏ workflow

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Å–µ–ª–ª–µ—Ä–æ–≤ —Å —Ç–∞—Ä–∏—Ñ–æ–º Pro/Enterprise
- **–ù–æ–¥–∞**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `{{$env.SUPABASE_URL}}/rest/v1/sellers?tariff_plan=in.(pro,enterprise)&select=id,tg_user_id,balance_rub`

#### –®–∞–≥ 2: Loop —á–µ—Ä–µ–∑ —Å–µ–ª–ª–µ—Ä–æ–≤
- **–ù–æ–¥–∞**: Split In Batches
- **Batch Size**: 1

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
- **–ù–æ–¥–∞**: IF
- **–£—Å–ª–æ–≤–∏–µ**: `{{$json.balance_rub}}` < 1000 (–ø–æ—Ä–æ–≥ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
- **–í–Ω—É—Ç—Ä–∏ IF**:
  - **HTTP Request**: –í—ã–∑–≤–∞—Ç—å workflow "send-telegram-notifications" —Å —Ç–∏–ø–æ–º `low_balance`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ü–æ—Ä–æ–≥ –±–∞–ª–∞–Ω—Å–∞**: 1000 ‚ÇΩ (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ IF —É—Å–ª–æ–≤–∏–∏)
- **–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –†–∞–∑ –≤ –¥–µ–Ω—å

---

## 12. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–º–ø–æ—Ä—Ç—É workflows

### 12.1. –ö–∞–∫ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON —Ñ–∞–π–ª—ã –≤ n8n

1. –û—Ç–∫—Ä—ã—Ç—å n8n –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "Workflows" –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
3. –ù–∞–∂–∞—Ç—å "Import from File" –∏–ª–∏ "Import from URL"
4. –í—ã–±—Ä–∞—Ç—å JSON —Ñ–∞–π–ª workflow
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –Ω–æ–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å credentials –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å workflow

### 12.2. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Settings ‚Üí Environment Variables
2. –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–º. —Ä–∞–∑–¥–µ–ª 1.2)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å n8n (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

### 12.3. –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π workflow

#### –î–ª—è Webhook workflows:
1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å webhook URL
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Postman –∏–ª–∏ curl:
```bash
curl -X POST https://your-n8n.com/webhook/test \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

#### –î–ª—è Schedule workflows:
1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow
2. –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–µ—Å—Ç–∞
3. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–ø—É—Å–∫–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ Execution History

### 12.4. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

1. –û—Ç–∫—Ä—ã—Ç—å workflow
2. –ù–∞–π—Ç–∏ –Ω–æ–¥—É Schedule Trigger
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:
   - **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ**: `0 3 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00)
   - **–ö–∞–∂–¥—ã–π —á–∞—Å**: `0 * * * *`
   - **–†–∞–∑ –≤ 3 –¥–Ω—è**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ Cron –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Interval
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å workflow

---

## 13. Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ workflow –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Execution History

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ Supabase
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL –∏ –∫–ª—é—á–µ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ Python —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Python —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å tg_user_id
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

---

## 14. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö workflows
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏
3. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å Execution History
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å workflows
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

---

## 15. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- n8n –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.n8n.io
- n8n community: https://community.n8n.io
- –ü—Ä–∏–º–µ—Ä—ã workflows: https://n8n.io/workflows

